<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML LANG=ENG>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=utf-8">
<LINK REL="stylesheet" HREF="includes/style.css" TYPE="text/css">
<title>Find mismatches בראשית</title>
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.branch-end, .branch-start').forEach(span => {
    span.addEventListener('mouseover', function() {
      const id = this.id;
      if (!id) return;
      const parts = id.split('-');
      const start = parseInt(parts[4]);
      const end = parseInt(parts[5]);
      const isTrope = id.startsWith('trop-');
      const table = span.closest('table');
      if (table) {
        for (let w = start; w <= end; w++) {
          const td = table.querySelector(`td[data-word="${w}"]`);
          if (td) {
            if (isTrope) {
              td.dataset.tropCount = (parseInt(td.dataset.tropCount || 0) + 1);
              if (parseInt(td.dataset.tropCount) > 0) td.classList.add('highlight-trop-bright');
            } else {
              td.dataset.syntaxCount = (parseInt(td.dataset.syntaxCount || 0) + 1);
              if (parseInt(td.dataset.syntaxCount) > 0) td.classList.add('highlight-syntax-bright');
            }
          }
        }
      }
    });
    span.addEventListener('mouseout', function() {
      const id = this.id;
      if (!id) return;
      const parts = id.split('-');
      const start = parseInt(parts[4]);
      const end = parseInt(parts[5]);
      const isTrope = id.startsWith('trop-');
      const table = span.closest('table');
      if (table) {
        for (let w = start; w <= end; w++) {
          const td = table.querySelector(`td[data-word="${w}"]`);
          if (td) {
            if (isTrope) {
              td.dataset.tropCount = parseInt(td.dataset.tropCount) - 1;
              if (parseInt(td.dataset.tropCount) <= 0) td.classList.remove('highlight-trop-bright');
            } else {
              td.dataset.syntaxCount = parseInt(td.dataset.syntaxCount) - 1;
              if (parseInt(td.dataset.syntaxCount) <= 0) td.classList.remove('highlight-syntax-bright');
            }
          }
        }
      }
    });
  });

  document.querySelectorAll('.mismatch_data .verse-trop, .mismatch_data .verse-syntax').forEach(span => {
    span.addEventListener('mouseover', function() {
      const isTrope = this.classList.contains('verse-trop');
      const mismatchDiv = this.closest('.mismatch_data');
      const tropSpan = mismatchDiv.querySelector('.verse-trop');
      const syntaxSpan = mismatchDiv.querySelector('.verse-syntax');
      const [tropStart, tropEnd] = tropSpan.dataset.words.split('-').map(Number);
      const [syntaxStart, syntaxEnd] = syntaxSpan.dataset.words.split('-').map(Number);
      const table = mismatchDiv.nextElementSibling;
      if (table) {
        // Highlight trope range
        for (let w = tropStart; w <= tropEnd; w++) {
          const td = table.querySelector(`td[data-word="${w}"]`);
          if (td) {
            td.classList.add(isTrope ? 'highlight-trop-bright' : 'highlight-trop-dim');
          }
        }
        // Highlight syntax range
        for (let w = syntaxStart; w <= syntaxEnd; w++) {
          const td = table.querySelector(`td[data-word="${w}"]`);
          if (td) {
            td.classList.add(isTrope ? 'highlight-syntax-dim' : 'highlight-syntax-bright');
          }
        }
      }
    });
    span.addEventListener('mouseout', function() {
      const isTrope = this.classList.contains('verse-trop');
      const mismatchDiv = this.closest('.mismatch_data');
      const tropSpan = mismatchDiv.querySelector('.verse-trop');
      const syntaxSpan = mismatchDiv.querySelector('.verse-syntax');
      const [tropStart, tropEnd] = tropSpan.dataset.words.split('-').map(Number);
      const [syntaxStart, syntaxEnd] = syntaxSpan.dataset.words.split('-').map(Number);
      const table = mismatchDiv.nextElementSibling;
      if (table) {
        // Remove trope highlights
        for (let w = tropStart; w <= tropEnd; w++) {
          const td = table.querySelector(`td[data-word="${w}"]`);
          if (td) {
            td.classList.remove('highlight-trop-bright', 'highlight-trop-dim');
          }
        }
        // Remove syntax highlights
        for (let w = syntaxStart; w <= syntaxEnd; w++) {
          const td = table.querySelector(`td[data-word="${w}"]`);
          if (td) {
            td.classList.remove('highlight-syntax-bright', 'highlight-syntax-dim');
          }
        }
      }
    });
  });
});
</script>
</head>
<body>